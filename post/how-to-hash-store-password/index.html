<!doctype html><html lang=en><head><script>(function(e,t,n,s,o){e[s]=e[s]||[],e[s].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var a=t.getElementsByTagName(n)[0],i=t.createElement(n),r=s!="dataLayer"?"&l="+s:"";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+o+r,a.parentNode.insertBefore(i,a)})(window,document,"script","dataLayer","GTM-K62WF7M4")</script><title>BÄƒm vÃ  lÆ°u password Ä‘Ãºng cÃ¡ch ::
/home/xluffy
</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://taoquangne.com/post/how-to-hash-store-password/><link rel=stylesheet href=https://taoquangne.com/assets/style.css><link rel=stylesheet href=https://taoquangne.com/style.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=https://taoquangne.com/img/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=https://taoquangne.com/img/favicon.png><link href=https://taoquangne.com/assets/fonts/Inter-Italic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://taoquangne.com/assets/fonts/Inter-Regular.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://taoquangne.com/assets/fonts/Inter-Medium.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://taoquangne.com/assets/fonts/Inter-MediumItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://taoquangne.com/assets/fonts/Inter-Bold.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://taoquangne.com/assets/fonts/Inter-BoldItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><meta name=twitter:card content="summary"><meta name=twitter:title content="BÄƒm vÃ  lÆ°u password Ä‘Ãºng cÃ¡ch"><meta property="og:url" content="https://taoquangne.com/post/how-to-hash-store-password/"><meta property="og:site_name" content="/home/xluffy"><meta property="og:title" content="BÄƒm vÃ  lÆ°u password Ä‘Ãºng cÃ¡ch"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2018-06-18T00:00:00+00:00"><meta property="article:modified_time" content="2018-06-18T00:00:00+00:00"><meta property="article:tag" content="Security"><meta property="article:tag" content="Password"><meta property="article:tag" content="Hash"></head><body class=dark-theme><div class=container><header class=header><span class=header__inner><a href=/ class=logo style=text-decoration:none><span class=logo__mark><svg class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg>
</span><span class=logo__text>/home/xluffy ft ğŸ„</span>
<span class=logo__cursor></span>
</a><span class=header__right><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/about>about</a></li><li><a href=/tags>tags</a></li><li><a href=https://github.com/xluffy/til/issues>til</a></li><li><a href=/weekly-summary>weekly-summary</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/about>about</a></li><li><a href=/tags>tags</a></li><li><a href=https://github.com/xluffy/til/issues>til</a></li><li><a href=/weekly-summary>weekly-summary</a></li></ul></nav><span class=menu-trigger><svg viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
</span><span class=theme-toggle><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><div class=post><h1 class=post-title>BÄƒm vÃ  lÆ°u password Ä‘Ãºng cÃ¡ch</h1><div class=post-meta><span class=post-date>2018-06-18</span></div><span class=post-tags><a href=https://taoquangne.com/tags/security/>#security</a>&nbsp;
<a href=https://taoquangne.com/tags/password/>#password</a>&nbsp;
<a href=https://taoquangne.com/tags/hash/>#hash</a>&nbsp;</span><div class=post-content><p>Sau khi Ä‘á»c bÃ i viáº¿t <a href=https://vnhacker.blogspot.com/2018/05/bam-mat-khau-ung-cach.html>bÄƒm máº­t kháº©u Ä‘Ãºng cÃ¡ch</a> cá»§a anh thaidn, mÃ¬nh nhá»› láº¡i lÃºc mÃ¬nh má»›i ra trÆ°á»ng, cÅ©ng Ä‘Ã£ tá»«ng nghÄ© vá» váº¥n Ä‘á» nÃ y (lÃºc Ä‘Ã³ mÃ¬nh khÃ¡ thÃ­ch mÃ´n Báº£o Máº­t ThÃ´ng Tin á»Ÿ trÆ°á»ng) nhÆ°ng chÆ°a bao giá» hiá»ƒu tÆ°á»ng táº­n. Chá»‰ biáº¿t lÃ  khÃ´ng nÃªn:</p><ul><li>LÆ°u password á»Ÿ dáº¡ng plain-text.</li><li>Hash vá»›i má»™t thuáº­t toÃ¡n hash máº¡nh, khÃ´ng nÃªn xÃ i MD5, SHA-1 &mldr;</li><li>Hash vá»›i salt.</li></ul><p>Chá»‰ hiá»ƒu ráº±ng pháº£i nÃªn lÃ m tháº¿, nhÆ°ng khÃ´ng hiá»ƒu táº¡i sao láº¡i nhÆ° váº­y vÃ  má»™t sá»‘ cÃ¢u há»i khÃ¡c cÅ©ng chÆ°a tráº£ lá»i Ä‘Æ°á»£c nhÆ°:</p><ul><li>Password user gá»­i lÃªn, nÃªn hash á»Ÿ client hay á»Ÿ server.</li><li>Salt nÃªn lÆ°u á»Ÿ Ä‘Ã¢u.</li><li>Salt cÃ³ cáº§n giá»¯ bÃ­ máº­t hay khÃ´ng?</li><li>Salt chung cho táº¥t cáº£, hay salt riÃªng cho tá»«ng user?</li></ul><p>HÃ´m nay, mÃ¬nh quyáº¿t Ä‘á»‹nh Ä‘i tÃ¬m cÃ¢u tráº£ lá»i cho nhá»¯ng váº¥n Ä‘á» mÃ¬nh tháº¯c máº¯c, thay vÃ¬ máº·c Ä‘á»‹nh nÃ³ Ä‘Ãºng.</p><h2 id=1-táº¡i-sao-khÃ´ng-nÃªn-lÆ°u-plain-text-encrypt-hoáº·c-dÃ¹ng-md5-sha-1>1. Táº¡i sao khÃ´ng nÃªn lÆ°u plain-text, encrypt hoáº·c dÃ¹ng MD5, SHA-1</h2><p>Náº¿u lÆ°u plain-text, database bá»‹ hack, SQL-injection, password user chÃ¬a ra theo má»™t cÃ¡ch khÃ´ng thá»ƒ dá»… dÃ ng hÆ¡n Ä‘á»ƒ Ä‘Ã¡nh cáº¯p.</p><p>Náº¿u mÃ£ hÃ³a 2 chiá»u, sáº½ luÃ´n cÃ³ má»™t cÃ¡ch Ä‘á»ƒ giáº£i mÃ£ báº±ng má»™t chÃ¬a-khÃ³a nÃ o Ä‘Ã³, sáº½ pháº£i tÃ¬m cÃ¡ch lÆ°u chÃ¬a-khÃ³a má»™t cÃ¡ch an toÃ n.</p><p>MD5 vÃ  SHA-1 Ä‘Æ°á»£c chá»©ng minh cÃ³ Ä‘á»¥ng Ä‘á»™, nghÄ©a lÃ  2 password khÃ¡c nhau, khi hash báº±ng MD5 hoáº·c SHA-1 cÃ³ thá»ƒ ra cÃ¹ng má»™t chuá»—i.</p><ul><li><a href=https://en.wikipedia.org/wiki/MD5#Collision_vulnerabilities>MD5 collision</a></li><li><a href=https://security.googleblog.com/2017/02/announcing-first-sha1-collision.html>SHA1 collision</a></li></ul><h2 id=2-táº¡i-sao-pháº£i-salt>2. Táº¡i sao pháº£i salt</h2><p>Ta Ä‘Ã£ biáº¿t, hash algorithm lÃ  one-way-function, tá»©c lÃ  khÃ´ng thá»ƒ suy ngÆ°á»£c trá»±c tiáº¿p ra password náº¿u cÃ³ hash_value (khÃ¡c vá»›i mÃ£ hÃ³a, cÃ³ thá»ƒ giáº£i mÃ£ thÃ´ng qua chÃ¬a-khÃ³a).</p><p>Tuy nhiÃªn váº«n cÃ³ cÃ¡ch Ä‘á»ƒ tá»« hash_value cÃ³ thá»ƒ suy giÃ¡n tiáº¿p ra Ä‘Æ°á»£c password vÃ­ dá»¥ brute-force attack, dictionary attack -> Ä‘iá»ƒm chung lÃ  ta cáº§n <strong>thá»­</strong> vÃ  <strong>Ä‘oÃ¡n</strong> password nhiá»u láº§n cho tá»›i khi Ä‘Ãºng cÃ¡i cáº§n tÃ¬m.</p><p>Má»™t cÃ¡ch khÃ¡c Ä‘Ã³ lÃ  ta cÃ³ thá»ƒ <strong>tÃ­nh toÃ¡n trÆ°á»›c</strong> giÃ¡ trá»‹ hash cá»§a táº¥t cáº£ cÃ¡c trÆ°á»ng há»£p vÃ  cá»§a táº¥t cáº£ cÃ¡c thuáº­t toÃ¡n -> cÃ¡ch nÃ y khÃ³, tá»‘n thá»i gian, nhÆ°ng bÃ¢y giá» vá»›i tá»‘c Ä‘á»™ tÃ­nh toÃ¡n cá»§a mÃ¡y tÃ­nh, ta váº«n cÃ³ thá»ƒ lÃ m Ä‘Æ°á»£c. Báº£ng lÆ°u trá»¯ password + hash_value cá»§a password gá»i lÃ  <strong><a href=http://project-rainbowcrack.com/table.htm>Rainbow Table</a></strong>, cÃ³ thá»ƒ tá»± táº¡o hoáº·c táº£i má»™t sá»‘ báº£n miá»…n phÃ­ hoáº·c tráº£ tiá»n Ä‘á»ƒ mua. Tá»« bÃ¢y giá» náº¿u ta cÃ³ hash_value ta cÃ³ thá»ƒ mapping Ä‘á»ƒ suy ra Ä‘Æ°á»£c password.</p><p>Tuy nhiÃªn náº¿u ta chá»‰ hash má»—i password, ta gáº·p váº¥n Ä‘á» Ä‘Ã³ lÃ :</p><ul><li><strong>2 password giá»‘ng nhau</strong> (user vÃ´ tÃ¬nh trÃ¹ng password) thÃ¬ chuá»—i <code>hash(password)</code> sáº½ giá»‘ng nhau.</li><li>User cá»‘ tÃ¬nh Ä‘áº·t password Ä‘Æ¡n giáº£n vÃ  phá»• biáº¿n (vÃ­ dá»¥ password &lt; 4 kÃ­ tá»±, toÃ n sá»‘, toÃ n chá»¯) -> dá»… nhá»› cho user nhÆ°ng dá»… tra ngÆ°á»£c.</li></ul><p>VÃ  náº¿u chá»‰ hash password thÃ¬ náº¿u máº¥t hash_value, cÃ³ thá»ƒ tra trong rainbow table Ä‘á»ƒ tÃ¬m ra Ä‘Æ°á»£c password cá»§a ngÆ°á»i dÃ¹ng.</p><p>Giá» ta thá»­ thay vÃ¬ <code>hash(password)</code> ta sáº½ <code>hash(salt + password)</code>:</p><p>Tá»« <code>md5(123456)</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>id |          hash_md5                |
</span></span><span style=display:flex><span>---------------------------------------
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span>  | e10adc3949ba59abbe56e057f20f883e |
</span></span></code></pre></div><p>ThÃ nh <code>md5(7nWZLcCK0vsPzIM + 123456)</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>id |          hash_md5                |    salt         |
</span></span><span style=display:flex><span>---------------------------------------------------------
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span>  | 0510210d4b370165658bdc0d0b005244 | 7nWZLcCK0vsPzIM |
</span></span></code></pre></div><p>Giá» giáº£ sá»­, ta máº¥t báº£ng dá»¯ liá»‡u gá»“m <code>hash_md5, salt</code>, káº» táº¥n cÃ´ng sáº½ pháº£i <strong>tÃ­nh toÃ¡n láº¡i</strong> rainbow table cá»§a táº¥t cáº£ cÃ¡c trÆ°á»ng há»£p cá»™ng vá»›i salt. Náº¿u salt lÃ  random cho tá»«ng user, káº» táº¥n cÃ´ng sáº½ pháº£i tÃ­nh toÃ¡n toÃ n bá»™ trÆ°á»ng há»£p cá»™ng vá»›i riÃªng tá»«ng salt cho toÃ n bá»™ user.</p><p>Chi phÃ­ cho 2 phÃ©p tÃ­nh trÃªn lÃ  vÃ´ cÃ¹ng lá»›n vÃ  tá»‘n ráº¥t nhiá»u thá»i gian Ä‘á»ƒ thá»±c hiá»‡n. Váº­y tÃ³m láº¡i má»¥c Ä‘Ã­ch cá»§a salt vÃ  random-salt lÃ :</p><ul><li>Báº£o vá»‡ user ká»ƒ cáº£ khi user dÃ¹ng password phá»• biáº¿n vÃ  password khÃ´ng máº¡nh vÃ¬ user khÃ´ng thá»ƒ nhá»› Ä‘Æ°á»£c cÃ¡c password phá»©c táº¡p nhÆ°ng tá»‘c Ä‘á»™ tÃ­nh toÃ¡n cá»§a mÃ¡y tÃ­nh thÃ¬ cÃ ng ngÃ y cÃ ng nhanh.</li><li>Táº¡o ra nhiá»u chi phÃ­ tÃ­nh toÃ¡n, káº» táº¥n cÃ´ng khÃ´ng thá»ƒ tÃ­nh toÃ¡n trÆ°á»›c rainbow table.</li></ul><p>=> Ta tráº£ lá»i Ä‘c 3 cÃ¢u há»i:</p><ul><li>Salt cÃ³ thá»ƒ lÆ°u trong database, cÃ¹ng vá»›i hash_value.</li><li>KhÃ´ng cáº§n tÃ¬m cÃ¡ch giá»¯ bÃ­ máº­t salt, nhÆ°ng cÅ©ng Ä‘á»«ng <strong>tá»± Ã½ cÃ´ng khai</strong> salt.</li><li>NhÆ°ng báº¯t buá»™c pháº£i random salt cho tá»«ng user.</li></ul><h2 id=3-hash-á»Ÿ-Ä‘Ã¢u>3. Hash á»Ÿ Ä‘Ã¢u?</h2><p>Giá» giáº£ sá»­ <code>hash(password)</code> á»Ÿ client-side thÃ¬ váº¥n Ä‘á» lÃ  gÃ¬?</p><ul><li>Biáº¿t Ä‘Æ°á»£c thuáº­t toÃ¡n dÃ¹ng Ä‘á»ƒ hash.</li><li>Salt sáº½ pháº£i sinh ra á»Ÿ client, vÃ¬ ta cáº§n hash password vá»›i salt (<code>hash(salt + password)</code>), vÃ  db chá»‰ lÆ°u káº¿t quáº£ hash, khÃ´ng lÆ°u salt.</li><li>NhÆ°ng náº¿u salt sinh ra á»Ÿ client vÃ  salt random thÃ¬ lÃ m sao Ä‘á»ƒ compare vá»›i hash_value trong database? VÃ¬ láº§n chá»©ng thá»±c tá»›i, salt sáº½ láº¡i random vÃ  sáº½ khÃ¡c vá»›i káº¿t quáº£ trong database -> salt pháº£i duy nháº¥t cho táº¥t cáº£ cÃ¡c trÆ°á»ng há»£p.</li><li>Hoáº·c salt cÃ³ thá»ƒ lÆ°u á»Ÿ DB, nhÆ°ng server pháº£i gá»­i salt vá» trÆ°á»›c cho user trÆ°á»›c khi thá»±c hiá»‡n hash -> dá»… dÃ ng biáº¿t Ä‘Æ°á»£c salt hÆ¡n.</li></ul><p>NhÃ¬n sÆ¡ thÃ¬ tháº¥y viá»‡c dÃ¹ng duy nháº¥t má»™t salt Ä‘Ã£ chá»‘ng láº¡i luáº­n Ä‘iá»ƒm á»Ÿ má»¥c sá»‘ 2. Váº­y quy trÃ¬nh chá»©ng thá»±c Ä‘Ãºng lÃ  nhÆ° tháº¿ nÃ o?</p><ul><li>User sáº½ gá»­i plain-text password lÃªn server vÃ  over HTTPs.</li><li>Server sáº½ kiá»ƒm tra trong database láº¥y ra salt cá»§a user Ä‘Ã³, cá»™ng chuá»—i ta Ä‘Æ°á»£c <code>salt + password</code>.</li><li>Thá»±c hiá»‡n <code>hash(salt + password)</code> trÃªn server side.</li><li>Compare káº¿t quáº£ trÃªn vá»›i <code>hash_md5</code> trong database.</li></ul><h2 id=4-táº¡i-sao-dÃ¹ng-bcrypt-thay-cho-sha-512>4. Táº¡i sao dÃ¹ng bcrypt thay cho SHA-512</h2><p>Káº¿t quáº£ cá»§a SHA-512 cÃ³ Ä‘á»™ dÃ i 128 kÃ­ tá»±, Ä‘á»™ dÃ i cá»§a key lÃ  64 bytes. TrÃ´ng cÃ³ váº» cÅ©ng khÃ¡ cháº¯c cháº¯n, váº­y táº¡i sao OWASP recommend sá»­ dá»¥ng PBKDF2, bcrypt hoáº·c scrypt hÆ¡n lÃ  SHA2?</p><p>SHA2 lÃ  hash algorithm (táº¥t nhiÃªn), nÃ³ Ä‘Æ°á»£c thiáº¿t káº¿ vá»›i má»¥c tiÃªu lÃ  tá»‘c Ä‘á»™, vá»›i cÃ¡c CPU hiá»‡n Ä‘áº¡i, cÃ³ thá»ƒ generate hÃ ng triá»‡u káº¿t quáº£ trÃªn giÃ¢y. Náº¿u dÃ¹ng má»™t thuáº­t toÃ¡n cÃ³ tá»‘c Ä‘á»™ nhÆ° SHA2 tá»©c lÃ  báº¡n Ä‘Ã£ Ä‘em lá»£i Ä‘iá»ƒm tá»›i cho káº» táº¥n cÃ´ng brute-force. Thuáº­t toÃ¡n nhanh + cáº¥u hÃ¬nh server máº¡nh, viá»‡c brute-force cÃ ng trá»Ÿ lÃªn nhanh chÃ³ng hÆ¡n.</p><p>Trong khi Ä‘Ã³, bcrypt Ä‘Æ°á»£c gá»i lÃ  slow-hash algorithm, <code>bcrypt()</code> máº¥t 100ms Ä‘á»ƒ tÃ­nh toÃ¡n ra chuá»—i hash, cháº­m hÆ¡n 10.000 láº§n so vá»›i sha1().</p><p>CÃ³ nghÄ©a lÃ  váº«n Ä‘áº¡t Ä‘Æ°á»£c má»¥c Ä‘Ã­ch hash nhÆ°ng giáº£m thiá»ƒu nguy cÆ¡ táº¥n cÃ´ng brute-force.</p><p><strong>TÃ³m láº¡i</strong>: SHA-512 khÃ´ng pháº£i lÃ  má»™t thuáº­t toÃ¡n yáº¿u, mÃ  váº¥n Ä‘á» lÃ  SHA-512 khÃ´ng phÃ¹ há»£p cho viá»‡c hash password. Náº¿u cáº§n hash password thÃ¬ ta nÃªn dÃ¹ng cÃ¡c thuáº­t toÃ¡n slow hash nhÆ° PBKDF2, bcrypt vÃ  scrypt.</p><h2 id=5-táº¡i-sao-cáº§n-pepper>5. Táº¡i sao cáº§n Pepper?</h2><p>Má»™t thá»±c táº¿ lÃ  náº¿u báº¡n chá»‰ cÃ³ &ldquo;muá»‘i&rdquo; mÃ  khÃ´ng cÃ³ &ldquo;tiÃªu&rdquo;, Äƒn thá»‹t gÃ  luá»™c sáº½ khÃ´ng ngon :v. Giáº£ sá»­, database báº¡n cháº¡y RAID-1, má»™t á»• cá»©ng hÆ° vÃ  cáº§n thay má»™t á»• cá»©ng má»›i. NhÆ°ng nhÆ° ta biáº¿t, Ä‘Ä©a bá»‹ hÆ° lÃ  mirror cá»§a Ä‘Ä©a cÃ²n láº¡i, báº¡n pháº£i tiÃªu há»§y á»• cá»©ng hÆ° Ä‘Ã³ náº¿u khÃ´ng ai Ä‘Ã³ cÃ³ thá»ƒ lá»¥c thÃ¹ng rÃ¡c vÃ  tÃ¡i táº¡o láº¡i má»™t pháº§n dá»¯ liá»‡u trong Ä‘Ä©a hÆ° Ä‘Ã³.</p><p>Xin lÆ°u Ã½, báº¡n cáº§n <code>wipe</code> trÆ°á»›c khi vá»©t bá» má»™t á»• cá»©ng cÃ³ dá»¯ liá»‡u dÃ¹ cÃ¡ nhÃ¢n hay server, tuy nhiÃªn Ä‘Ä©a bá»‹ sá»‘c Ä‘iá»‡n, bad-sector thÃ¬ <code>wipe</code> cÅ©ng chÆ°a Ä‘á»§ an toÃ n, tá»‘t nháº¥t nÃªn ngiá»n ra bÃ£.</p><p>DÃ¹ random-salt Ä‘Ã£ lÃ m tÄƒng chi phÃ­ táº¡o ra rainbow table nhÆ°ng Ä‘á»i khÃ´ng biáº¿t Ä‘Ã¢u mÃ  láº§n, káº» táº¥n cÃ´ng luÃ´n cÃ³ nhá»¯ng Ä‘á»™ng lá»±c khÃ´ng tÆ°á»Ÿng Ä‘á»ƒ Ä‘áº¡t Ä‘Æ°á»£c cÃ¡i mÃ¬nh muá»‘n. Giáº£ sá»­ káº» táº¥n cÃ´ng cÃ³ má»™t siÃªu siÃªu mÃ¡y tÃ­nh vÃ  má»™t mirror á»• cá»©ng hÆ° lá»¥c tá»« má»™t cÃ¡i thÃ¹ng rÃ¡c nÃ o Ä‘Ã³. Vá»›i siÃªu mÃ¡y tÃ­nh Ä‘Ã³, ta cÃ³ rainbow-table Ä‘á»ƒ tra ngÆ°á»£c ra password cáº§n tÃ¬m.</p><p>Váº­y lÃ m sao Ä‘á»ƒ giáº£m thiá»ƒu nguy cÆ¡ trÃªn? NguyÃªn táº¯c lÃ  khÃ´ng bá» táº¥t cáº£ trá»©ng trong má»™t giá», Ä‘Ã³ lÃ  pepper. Pepper lÃ  má»™t chuá»—i tÆ°Æ¡ng tá»± nhÆ° salt, nhÆ°ng khÃ¡c biá»‡t lÃ  ta cáº§n <strong>giá»¯ bÃ­ máº­t pepper</strong>, lÆ°u á»Ÿ má»™t chá»— khÃ¡c ngoÃ i database, vÃ  khÃ´ng cáº§n pepper-per-user, chá»‰ cáº§n 1 pepper lÃ  Ä‘á»§.</p><p>Tá»«</p><pre tabindex=0><code>hash(salt + password)
</code></pre><p>ThÃ nh</p><pre tabindex=0><code>hash(pepper + salt + password)
</code></pre><p>Ta nÃªn lÆ°u pepper á»Ÿ application hoáº·c á»Ÿ má»™t service khÃ¡c, náº¿u database bá»‹ compromise, thÃ¬ káº» táº¥n cÃ´ng cÅ©ng khÃ´ng cÃ³ pepper Ä‘á»ƒ táº¡o ra rainbow-table.</p><h2 id=6-bonus>6. Bonus</h2><p align=center><img src=https://dropbox.tech/cms/content/dam/dropbox/tech-blog/en-us/2016/09/layers.png alt=layers width=65%><a href=https://blogs.dropbox.com/tech/2016/09/how-dropbox-securely-stores-your-passwords><i>Source: https://blogs.dropbox.com/tech/2016/09/how-dropbox-securely-stores-your-passwords</i></a></p><p>Trong khi tÃ¬m cÃ¢u tráº£ lá»i Ä‘á»ƒ viáº¿t bÃ i nÃ y, mÃ¬nh tÃ¬m Ä‘Æ°á»£c má»™t bÃ i blog cá»§a dropbox nÃ³i vá» cÃ¡ch há» lÆ°u password nhÆ° tháº¿ nÃ o. Tháº¥y cÃ³ 2 Ä‘iá»ƒm khÃ¡ hay nÃªn muá»‘n nÃ³i thÃªm.</p><ul><li>TrÆ°á»›c khi hash password vá»›i salt-per-user, há» cÃ³ <code>SHA512(password)</code> trÆ°á»›c Ä‘á»ƒ <strong>cá»‘ Ä‘á»‹nh</strong> Ä‘á»™ dÃ i cá»§a input-password. Theo Dropbox thÃ¬ viá»‡c nÃ y giáº£i quyáº¿t 2 issues cá»§a <code>bcrypt</code><ul><li>Má»™t sá»‘ implementation cá»§a bcrypt cáº¯t Ä‘áº§u vÃ o cÃ²n 72 bytes.</li><li>Má»™t sá»‘ implementation khÃ¡c cá»§a bcrypt thÃ¬ khÃ´ng cáº¯t Ä‘áº§u vÃ o nhÆ°ng dáº«n tá»›i má»™t váº¥n Ä‘á» khÃ¡c lÃ  DoS attack bá»Ÿi vÃ¬ cho phÃ©p Ä‘á»™ dÃ i máº­t kháº©u tÃ¹y Ã½.</li></ul></li><li>Dropbox cÅ©ng cÃ³ <strong>global pepper</strong> nhÆ°ng thay vÃ¬ dÃ¹ng nÃ³ Ä‘á»ƒ hash thÃ¬ há» encrypt. Tá»©c lÃ  thay vÃ¬ <code>hash(pepper + salt + password)</code> thÃ¬ há» <code>AES256(salt + password) + global-pepper-key</code>. Theo nhÆ° há» giáº£i thÃ­ch thÃ¬ pepper lÃ  má»™t lá»›p phÃ²ng thá»§ sÃ¢u hÆ¡n vÃ  lÆ°u trá»¯ á»Ÿ má»™t nÆ¡i riÃªng biá»‡t. NhÆ°ng Ä‘á»“ng nghÄ©a vá»›i viá»‡c lÃ  nÆ¡i lÆ°u trá»¯ pepper váº«n cÃ³ thá»ƒ bá»‹ compromise, vÃ  khi bá»‹ compromise thÃ¬ viá»‡c rotate key khÃ´ng dá»… dÃ ng. DÃ¹ng pepper Ä‘á»ƒ encrypt váº«n Ä‘áº¡t Ä‘Æ°á»£c má»¥c Ä‘Ã­ch báº£o máº­t tÆ°Æ¡ng tá»± nhÆ°ng thÃªm kháº£ nÄƒng rotate key khi bá»‹ compromise.</li></ul><h2 id=7-migrate>7. Migrate</h2><p>Sau khi viáº¿t bÃ i nÃ y, báº¡n <a href=https://github.com/vanhtuan0409>@vanhtuan0409</a> cÃ³ má»™t cÃ¢u há»i vá» viá»‡c lÃ m tháº¿ nÃ o migrate má»™t há»‡ thá»‘ng dÃ¹ng SHA1 &ndash;> bcrypt. MÃ¬nh tháº¥y Ä‘Ã¢y lÃ  má»™t Ä‘iá»ƒm cÅ©ng khÃ¡ cáº§n thiáº¿t nÃªn xin phÃ©p note thÃªm.</p><p>á» Ä‘Ã¢y cÃ³ 2 trÆ°á»ng há»£p:</p><ul><li>Hash password báº±ng SHA1 nhÆ°ng khÃ´ng cÃ³ salt -> mÃ¬nh gá»i lÃ  <code>sha1_value</code>.</li><li>Hash password báº±ng SHA1 + trong DB cÃ³ salt-per-user, mÃ¬nh cÃ³ <code>sha1_value, salt</code>.</li></ul><p>Vá» Ã½ tÆ°á»Ÿng thÃ¬ ta sáº½ dÃ¹ng SHA1 nhÆ° cÃ¡ch Dropbox dÃ¹ng SHA512 Ä‘á»ƒ cá»‘ Ä‘á»‹nh Ä‘á»™ dÃ i input.</p><p>Vá»›i trÆ°á»ng há»£p Ä‘áº§u ta cáº§n sinh ra thÃªm salt-per-user vÃ  migrate <code>bcrypt(salt, sha1_value)</code> trong Ä‘Ã³ <code>sha1_value = SHA1(password)</code> -> TÆ°Æ¡ng tá»± cÃ¡ch cá»§a dropbox, <strong>may máº¯n</strong> lÃ  do sai thiáº¿t káº¿ tá»« Ä‘áº§u (thiáº¿u salt) nÃªn migrate dá»….</p><p>Vá»›i trÆ°á»ng há»£p thá»© 2 thÃ¬ hÆ¡i láº±ng nháº±ng hÆ¡n 1 xÃ­u, ta cáº§n migrate kiá»ƒu <code>bcrypt(salt, SHA1(salt, password))</code> náº¿u thá»±c sá»± muá»‘n bcrypt vá»›i salt hoáº·c thá»±c ra chá»‰ cáº§n <code>bcrypt(SHA1(salt, password)</code> cÅ©ng Ä‘Æ°á»£c. TÃ¹y tÃ¬nh huá»‘ng báº¡n cáº§n tradeoff cÃ³ thá»ƒ lá»±a chá»n cÃ¡ch phÃ¹ há»£p.</p><h2 id=8-thÃ´ng-tin-cá»§a-báº¡n-cÃ³-an-toÃ n>8. ThÃ´ng tin cá»§a báº¡n cÃ³ an toÃ n?</h2><p>NhÆ° ta tháº¥y, ta Ä‘Ã£ lÃ m ráº¥t nhiá»u thá»© Ä‘á»ƒ Ä‘áº£m báº£o ráº±ng thÃ´ng tin cá»§a chÃºng ta trá»Ÿ lÃªn an toÃ n. Váº­y thá»±c sá»± thÃ´ng tin cá»§a chÃºng ta Ä‘Ã£ an toÃ n hay khÃ´ng? CÃ¢u tráº£ lá»i ráº¥t tiáº¿c lÃ  KHÃ”NG? ThÃ´ng tin cá»§a chÃºng ta cÃ³ thá»ƒ an toÃ n vá»›i &ldquo;bÃªn ngoÃ i&rdquo; nhÆ°ng khÃ´ng an toÃ n vá»›i &ldquo;bÃªn trong&rdquo;. Táº¡i sao láº¡i váº­y?</p><p>Giá» báº¯t Ä‘áº§u vá»›i thÃ´ng tin cÆ¡ báº£n nháº¥t nhÆ° Ä‘á»‹a chá»‰, email, sá»Ÿ thÃ­ch &mldr; Khi ta build staing environment, thÃ´ng tin user Ä‘Æ°á»£c copy sang má»™t mÃ´i trÆ°á»ng khÃ¡c, developer cÃ³ thá»ƒ overwrite hash_value cá»§a user báº±ng value cá»§a <code>hash(salt + 654321)</code> vÃ  dá»… dÃ ng Ä‘Äƒng nháº­p trÃªn staing environment vá»›i password lÃ  <code>654321</code> vÃ  táº¥t cáº£ cÃ¡c thÃ´ng tin cÆ¡ báº£n cá»§a user Ä‘Ã£ cÃ³ thá»ƒ Ä‘á»c Ä‘Æ°á»£c. NhÆ°ng Ã­t nháº¥t developer váº«n khÃ´ng biáº¿t chÃ­nh xÃ¡c password cá»§a user lÃ  gÃ¬.</p><p>NhÆ°ng, láº¡i lÃ  nhÆ°ng. NgÆ°á»i quáº£n trá»‹ há»‡ thá»‘ng cÃ³ má»i quyá»n trÃªn server mÃ  há» quáº£n trá»‹, password dÃ¹ Ä‘Ã£ over HTTPs nhÆ°ng tá»›i server váº«n lÃ  plain-text. Váº«n cÃ³ thá»ƒ capture request ngay á»Ÿ Ä‘áº§u server vÃ  output ra plain-text password cá»§a user vÃ  cuá»‘i cÃ¹ng thÃ¬ ngÆ°á»i quáº£n trá»‹ há»‡ thá»‘ng váº«n biáº¿t Ä‘Æ°á»£c chÃ­nh xÃ¡c password cá»§a user lÃ  gÃ¬. ÄÃ³ lÃ  lÃ­ do táº¡i sao ta khÃ´ng nÃªn dÃ¹ng má»™t password cho táº¥t cáº£ cÃ¡c dá»‹ch vá»¥.</p><p>Váº­y lÃ m tháº¿ nÃ o Ä‘á»ƒ báº£o vá»‡ info cá»§a user trong trÆ°á»ng há»£p nÃ y, ráº¥t tiáº¿c vá» máº·t ká»¹ thuáº­t khÃ´ng cÃ³ cÃ¡ch nÃ o Ä‘á»ƒ Ä‘áº£m báº£o viá»‡c nÃ y. Ta chá»‰ cÃ³ thá»ƒ Ã¡p dá»¥ng policy, NDA vá» máº·t con ngÆ°á»i Ä‘á»ƒ háº¡n cháº¿ váº¥n Ä‘á» nÃ y thÃ´i.</p><h2 id=9-ref>9. Ref</h2><ul><li><a href=https://security.stackexchange.com/questions/211/how-to-securely-hash-passwords>https://security.stackexchange.com/questions/211/how-to-securely-hash-passwords</a></li><li><a href=https://blogs.dropbox.com/tech/2016/09/how-dropbox-securely-stores-your-passwords>https://blogs.dropbox.com/tech/2016/09/how-dropbox-securely-stores-your-passwords</a></li></ul><p><strong>LÆ°u Ã½</strong>:</p><ul><li>Trong bÃ i viáº¿t dÃ¹ng MD5 Ä‘á»ƒ minh há»a cho Ä‘Æ¡n giáº£n, trong thá»±c táº¿ ta khÃ´ng dÃ¹ng MD5.</li><li>Trong bÃ i viáº¿t giáº£ Ä‘á»‹nh káº» táº¥n cÃ´ng báº±ng cÃ¡ch nÃ o Ä‘Ã³ cÃ³ db users, trong thá»±c táº¿ viá»‡c nÃ y ráº¥t khÃ³ do cÃ³ cÃ¡c táº§ng báº£o máº­t khÃ¡c nhÆ° thiáº¿t káº¿ infrastructure, define rule/policy vá» con ngÆ°á»i &mldr; Trong bÃ i nÃ y mÃ¬nh khÃ´ng bÃ n Ä‘áº¿n cÃ¡c váº¥n Ä‘á» Ä‘Ã³.</li></ul></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://taoquangne.com/post/noted-c++/><span class=button__icon>â†</span>
<span class=button__text>Tham chiáº¿u vÃ  con trá» trong C++</span>
</a></span><span class="button next"><a href=https://taoquangne.com/post/what-is-difference-between-ssl-tls-https/><span class=button__text>What is difference between SSL, TLS, and HTTPs?</span>
<span class=button__icon>â†’</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user"><span>hÃ ng nhÃ  trá»“ng ğŸŒ´ theo <a href=https://creativecommons.org/licenses/by-nc/4.0>giáº¥y phÃ©p CC BY-NC 4.0</a></span><span>Themes created by <a href=https://twitter.com/panr target=_blank rel=noopener>panr</a></span></div></div></footer><script src=https://taoquangne.com/assets/main.js></script><script src=https://taoquangne.com/assets/prism.js></script></div><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-K62WF7M4" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript></body></html>