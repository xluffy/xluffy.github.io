<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>
        Up firmware Padavan cho MI4 ::
        /home/xluffy
      </title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta
  name="description"
  content="Sau một thời gian xài cái modem kèm wifi lởm lởm của nhà mạng VNPT khi mà sóng quá yếu, đi xa một xíu là tạch hết."
/>
<meta
  name="keywords"
  content=""
/>
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://taoquangne.com/post/up-firmware-padavan-mi4/" />





<link rel="stylesheet" href="https://taoquangne.com/assets/style.css" />

<link rel="stylesheet" href="https://taoquangne.com/style.css" />


<link
  rel="apple-touch-icon-precomposed"
  sizes="144x144"
  href="https://taoquangne.com/img/apple-touch-icon-144-precomposed.png"
/>
<link rel="shortcut icon" href="https://taoquangne.com/img/favicon.png" />


<link href="https://taoquangne.com/assets/fonts/Inter-Italic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="https://taoquangne.com/assets/fonts/Inter-Regular.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="https://taoquangne.com/assets/fonts/Inter-Medium.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="https://taoquangne.com/assets/fonts/Inter-MediumItalic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="https://taoquangne.com/assets/fonts/Inter-Bold.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="https://taoquangne.com/assets/fonts/Inter-BoldItalic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Up firmware Padavan cho MI4"/>
<meta name="twitter:description" content="Sau một thời gian xài cái modem kèm wifi lởm lởm của nhà mạng VNPT khi mà sóng quá yếu, đi xa một xíu là tạch hết."/>



<meta property="og:title" content="Up firmware Padavan cho MI4" />
<meta property="og:description" content="Sau một thời gian xài cái modem kèm wifi lởm lởm của nhà mạng VNPT khi mà sóng quá yếu, đi xa một xíu là tạch hết." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://taoquangne.com/post/up-firmware-padavan-mi4/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-11-11T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-11-11T00:00:00+00:00" /><meta property="og:site_name" content="/home/xluffy" />







  </head>
  <body class="">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a
  href="/"
  class="logo"
  style="text-decoration: none;"
>
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367" />
</svg>
</span>
    <span class="logo__text"
      >/home/xluffy ft 🍄</span
    >
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about">about</a></li>
        
      
        
          <li><a href="/tags">tags</a></li>
        
      
        
          <li><a href="https://github.com/xluffy/til/issues">til</a></li>
        
      
        
          <li><a href="/weekly-summary">weekly-summary</a></li>
        
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about">about</a></li>
      
    
      
        <li><a href="/tags">tags</a></li>
      
    
      
        <li><a href="https://github.com/xluffy/til/issues">til</a></li>
      
    
      
        <li><a href="/weekly-summary">weekly-summary</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none" />
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z" />
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg
  class="theme-toggler"
  width="24"
  height="24"
  viewBox="0 0 48 48"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"
  />
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  
  

  <div class="post">
    <h1 class="post-title">Up firmware Padavan cho MI4</h1>
    <div class="post-meta">
      
        <span class="post-date">
          2021-11-11
        </span>

        
          
        
      

      


      
    </div>

    
      <span class="post-tags">
        
          <a href="https://taoquangne.com/tags/mi4/">#mi4</a>&nbsp;
        
          <a href="https://taoquangne.com/tags/pandavan/">#pandavan</a>&nbsp;
        
      </span>
    

    

    <div class="post-content">
      
      <p>Sau một thời gian xài cái modem kèm wifi lởm lởm của nhà mạng VNPT khi mà sóng quá yếu, đi xa một xíu là tạch hết. Quyết định sẽ kiếm một cái router wifi thay thế. Yêu cầu với thiết bị mới là:</p>
<ul>
<li>Rẻ, tầm vài trăm ngìn vì nhà cũng chỉ có hơn 60m2 nên không có nhu cầu dùng Mesh.</li>
<li>Nhưng ông nào có điều kiện thì cứ xài Mesh nhé, xài mấy con sóng khoẻ, xuyên tường, xuyên gạch quá ko tốt cho 🦜</li>
<li>Nghịch được, có thể cài firmware (ví dụ OpenWrt) hoặc tuỳ chỉnh các chức năng như chặn quảng cáo (AdGuard, Pi-hole) hoặc các chức năng VPN.</li>
<li>An toàn, không chứa em bé, bọ, gián gì nhé 🪲🪳🕷.</li>
</ul>
<h2 id="1-lựa-chọn-thiết-bị">1. Lựa chọn thiết bị</h2>
<p>Sau một hồi lượn lờ VoZ thấy mấy em Mi Router có vẻ ngon về cấu hình dù là hàng nội địa Trung Quốc, nên quyết định order một em <a href="https://www.mi.com/miwifi4/specs/">MI4</a> trên Shopee về nghịch, giá chỉ tầm 350k, anh em tự search nhé. Cấu hình như sau:</p>
<ul>
<li><strong>CPU</strong>: MT7621A MIPS Dual core 880MHz</li>
<li><strong>ROM</strong>: 128MB SLC Nand Flash</li>
<li><strong>RAM</strong>: 128MB DDR3-1200</li>
<li><strong>2.4G Wifi</strong>: 2 X 2 (IEEE 802.11N protocol supported, up to 300Mbps) (5dBi)</li>
<li><strong>5G Wifi</strong>: 2 X 2 (IEEE 802.11AC protocol supported, up to 867Mbps) (6dBi)</li>
<li><strong>Network Protocols</strong>: IEEE 802.11a/b/g/n/ac, IEEE 802.3/3u/3ab</li>
<li><strong>LAN</strong>: 2 port x 10/100/1000M</li>
<li><strong>WAN</strong>: 1 x 10/1000M</li>
<li><strong>OS</strong>: <a href="https://bigota.miwifi.com/xiaoqiang/rom/r4/miwifi_r4_firmware_8ed47_2.26.175.bin">MiWifi Rom tiếng Trung based OpenWRT</a></li>
</ul>
<p>Hình em nó đây, nhìn cũng đẹp phết.</p>
<p align="center"><img <img src="https://raw.githubusercontent.com/xluffy/assets/master/miwifi4.jpg" alt="miwifi4" style="width:90%;" /></p>
<p>Bản tui mua trên Shopee là đồ cũ, đã sử dụng rồi và được bạn bán cung cấp 2 phiên bản:</p>
<ul>
<li>Phiên bản ROM gốc, tiếng Trung và xài <a href="https://deviwiki.com/wiki/Xiaomi_MiWiFi_4">U-Boot bootloader</a></li>
<li>Phiên bản Padavan tiếng Việt và tui dự là bạn í xài BREED bootloader</li>
</ul>
<p>Tui đã mua bản Padavan Tiếng Việt vì quá lười tự mò để cài firmware, nhưng load vô giao diện quản trị thấy bạn í để lại copyright nên cũng hơi nghi ngại, một phần liên quan đến bootloader (sẽ nói sau) nên quyết định thử build lại firmware sẵn nghiên cứu luôn.</p>
<h2 id="2-firmware">2. Firmware</h2>
<p>Trên VoZ rất nhiều anh em xài Padavan, lướt sơ sơ thấy firmware này có vẻ ổn và có hỗ trợ cả tiếng Việt nên quyết định cũng sẽ xài tiếp firmware này luôn. Padavan là firmware mở được &ldquo;xào&rdquo; bởi <a href="https://github.com/andy-padavan">Andy Padavan</a> một lập trình viên người Nga. Repo gốc đặt tại <a href="https://bitbucket.org/padavan/rt-n56u/src/master/">bitbucket</a> và mirror <a href="https://github.com/andy-padavan/rt-n56u">github</a>, last commit là vào 05/11/2018. Đây xem như là Padavan gốc vì sau này sẽ có rất nhiều các bản chế lại dựa trên bản gốc này.</p>
<p>Ví dụ một phiên bản Trung do mấy bạn Trung xào lại <a href="https://github.com/hanwckf/rt-n56u">https://github.com/hanwckf/rt-n56u</a>, phiên bản này có một số khác biệt so với bản gốc như sau:</p>
<ul>
<li><a href="https://github.com/hanwckf/rt-n56u#%E5%9B%BA%E4%BB%B6%E7%89%B9%E7%82%B9">Hỗ trợ nhiều thiết bị hơn</a></li>
<li>Xài AriaNg thay cho aira2</li>
<li>Xài một phần <a href="https://gitlab.com/padavan-ng/padavan-ng">padavan-ng</a></li>
<li>Tuỳ chọn sẵn một số gói phần mềm (curl, htop, nano, samba3.6, sock, vpn và các gói hỗ trợ gắn card 3/4G)</li>
<li>Tiếng Trung từ bộ từ điển <a href="https://github.com/gorden5566/padavan">gorden5566</a></li>
</ul>
<p>Do bản tiếng Trung này có hỗ trợ <a href="https://github.com/hanwckf/rt-n56u/pull/671">MI-4</a> nên tui cũng sẽ xài bản này luôn, nhưng do đây là bản tiếng Trung nên cần load từ điển tiếng Việt để xài, may mắn thay đã có một bạn làm sẵn bộ <a href="https://github.com/daivietpda/PDVN-LANG">từ điển tiếng Việt cho Padavan</a>. Việc bây giờ là tìm hiểu cách build firmware, tuỳ chỉnh các package để xài thử.</p>
<h2 id="3-chuẩn-bị-môi-trường-build">3. Chuẩn bị môi trường build</h2>
<p>Dựa chủ yếu vào <a href="https://github.com/hanwckf/rt-n56u/blob/master/README.md">README của bản tiếng Trung</a> có tham khảo <a href="https://bitbucket.org/padavan/rt-n56u/wiki/EN/HowToMakeFirmware">WIKI Pandava gốc</a>. Tui sẽ dùng Ubuntu 16.04 LTS i386, tránh nhầm x86_64 (hoặc amd64) nhé. Để đỡ mất công cài đặt thì sử dụng luôn Vagrant cho tiện, <code>Vagrantfile</code> như sau (cấp RAM/CPU nhiều để build cho lẹ, đỡ mất thời gian chờ):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#75715e"># -*- mode: ruby -*-</span>
<span style="color:#75715e"># vi: set ft=ruby :</span>

<span style="color:#66d9ef">Vagrant</span><span style="color:#f92672">.</span>configure(<span style="color:#e6db74">&#39;2&#39;</span>) <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>config<span style="color:#f92672">|</span>
  config<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>box <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;ubuntu/xenial32&#39;</span>
  config<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>box_url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;ubuntu/xenial32&#39;</span>
  config<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>hostname <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;padavan-box&#39;</span>
  config<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>provider <span style="color:#e6db74">&#39;virtualbox&#39;</span> <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>vb<span style="color:#f92672">|</span>
    vb<span style="color:#f92672">.</span>gui <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>
    vb<span style="color:#f92672">.</span>memory <span style="color:#f92672">=</span> <span style="color:#ae81ff">2048</span>
    vb<span style="color:#f92672">.</span>cpus <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>
  <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span>
</code></pre></div><p>Sau đó tạo và cấu hình machine dựa trên <code>Vagrantfile</code> phía trên</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">&gt; vagrant up

Bringing machine <span style="color:#e6db74">&#39;default&#39;</span> up with <span style="color:#e6db74">&#39;virtualbox&#39;</span> provider...
<span style="color:#f92672">==</span>&gt; default: Importing base box <span style="color:#e6db74">&#39;ubuntu/xenial32&#39;</span>...
<span style="color:#f92672">==</span>&gt; default: Matching MAC address <span style="color:#66d9ef">for</span> NAT networking...
<span style="color:#f92672">==</span>&gt; default: Checking <span style="color:#66d9ef">if</span> box <span style="color:#e6db74">&#39;ubuntu/xenial32&#39;</span> version <span style="color:#e6db74">&#39;20211001.0.0&#39;</span> is up to date...
<span style="color:#f92672">==</span>&gt; default: Setting the name of the VM: vargrant_default_1636614238976_86823
<span style="color:#f92672">==</span>&gt; default: Clearing any previously set network interfaces...
<span style="color:#f92672">==</span>&gt; default: Preparing network interfaces based on configuration...
    default: Adapter 1: nat
<span style="color:#f92672">==</span>&gt; default: Forwarding ports...
    default: <span style="color:#ae81ff">22</span> <span style="color:#f92672">(</span>guest<span style="color:#f92672">)</span> <span style="color:#f92672">=</span>&gt; <span style="color:#ae81ff">2222</span> <span style="color:#f92672">(</span>host<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>adapter 1<span style="color:#f92672">)</span>
<span style="color:#f92672">==</span>&gt; default: Running <span style="color:#e6db74">&#39;pre-boot&#39;</span> VM customizations...
<span style="color:#f92672">==</span>&gt; default: Booting VM...
<span style="color:#f92672">==</span>&gt; default: Waiting <span style="color:#66d9ef">for</span> machine to boot. This may take a few minutes...
    default: SSH address: 127.0.0.1:2222
    default: SSH username: vagrant
    default: SSH auth method: private key
    default: Warning: Connection reset. Retrying...
    default: Warning: Remote connection disconnect. Retrying...
    default:
    default: Vagrant insecure key detected. Vagrant will automatically replace
    default: this with a newly generated keypair <span style="color:#66d9ef">for</span> better security.
    default:
    default: Inserting generated public key within guest...
    default: Removing insecure key from the guest <span style="color:#66d9ef">if</span> it<span style="color:#960050;background-color:#1e0010">&#39;</span>s present...
    default: Key inserted! Disconnecting and reconnecting using new SSH key...
<span style="color:#f92672">==</span>&gt; default: Machine booted and ready!

&gt; vagrant status
Current machine states:

default	running <span style="color:#f92672">(</span>virtualbox<span style="color:#f92672">)</span>
</code></pre></div><p>SSH vào máy ảo và kiểm tra một số thông tin:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">&gt; vagrant ssh

&gt; cat /etc/issue
Ubuntu 16.04.7 LTS <span style="color:#ae81ff">\n</span> <span style="color:#ae81ff">\l</span>

&gt; uname -a
Linux padavan-box 4.4.0-210-generic <span style="color:#75715e">#242-Ubuntu SMP Fri Apr 16 09:57:00 UTC 2021 i686 i686 i686 GNU/Linux</span>
</code></pre></div><p>Cài đặt các gói cần thiết để biên dịch:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">&gt; apt update
&gt; apt install automake autopoint bison build-essential cmake cpio curl fakeroot flex gawk gettext git gperf <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>			  help2man kmod libc-dev-bin libgmp3-dev libltdl-dev libmpc-dev libmpfr-dev libncurses5-dev libtool-bin <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>		      nano pkg-config python3-docutils texinfo unzip wget zlib1g-dev --no-install-recommends -y
</code></pre></div><p>Tải mã nguồn:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">&gt; mkdir -pv /build
&gt; cd /build
&gt; git clone https://github.com/hanwckf/rt-n56u.git
</code></pre></div><p><del>Và do cần giao diện tiếng Việt, nên nhớ tải bộ từ điển tiếng Việt:</del></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">&gt; cd rt-n56u
&gt; ls -l trunk/user/www/dict/*.dict
&gt; wget -O trunk/user/www/dict/VN.dict https://raw.githubusercontent.com/daivietpda/PDVN-LANG/master/VN.dict
</code></pre></div><p><del>Lưu ý sau khi có bộ từ điển tiếng Việt, cần phải chỉnh 2 chỗ nữa là trong config mà Makefile</del></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># trunk/configs/templates/MI-4.config</span>
CONFIG_FIRMWARE_INCLUDE_LANG_VN

<span style="color:#75715e"># trunk/user/www/Makefile</span>
ifeq <span style="color:#f92672">(</span><span style="color:#66d9ef">$(</span>CONFIG_FIRMWARE_INCLUDE_LANG_VN<span style="color:#66d9ef">)</span>,y<span style="color:#f92672">)</span>
        echo <span style="color:#e6db74">&#34;LANG_VN=Tiếng Việt&#34;</span> &gt;&gt; <span style="color:#66d9ef">$(</span>ROMFS_DIR<span style="color:#66d9ef">)</span>/www/EN.header
        cp dict/VN.dict <span style="color:#66d9ef">$(</span>ROMFS_DIR<span style="color:#66d9ef">)</span>/www
        sed <span style="color:#66d9ef">$(</span>BOARD_PATTERN<span style="color:#66d9ef">)</span> -i <span style="color:#66d9ef">$(</span>ROMFS_DIR<span style="color:#66d9ef">)</span>/www/VN.dict
        sed <span style="color:#66d9ef">$(</span>COPYR_PATTERN<span style="color:#66d9ef">)</span> -i <span style="color:#66d9ef">$(</span>ROMFS_DIR<span style="color:#66d9ef">)</span>/www/VN.dict
        sed <span style="color:#66d9ef">$(</span>DWURL_PATTERN<span style="color:#66d9ef">)</span> -i <span style="color:#66d9ef">$(</span>ROMFS_DIR<span style="color:#66d9ef">)</span>/www/VN.dict
        sed <span style="color:#66d9ef">$(</span>DWURL_MOD_PATTERN<span style="color:#66d9ef">)</span> -i <span style="color:#66d9ef">$(</span>ROMFS_DIR<span style="color:#66d9ef">)</span>/www/VN.dict
endif
</code></pre></div><p>Sau một hồi test thử bản tiếng Việt mãi không được, tui hơi bị lười debug nên thôi bỏ qua vụ tiếng Việt nhé =))) fen nào muốn tự xử thì các bước cũng tựa như trên, debug thêm nhé, chứ tiếng Anh tiếng Việt cũng ko vấn đề gì lắm.</p>
<p>Xong xuôi các bước trên là đã chuẩn bị đủ, bây giờ tui sẽ build <code>toolchain</code> (cross-compiler and tools for building) trước, để có cái tí build firmware. Trong bản Padavan của thím <code>hanwckf</code> có sẵn phiên bản pre-build của toolchain, fen nào thích thì tải về hoặc chạy script <code>dl_toolchain.sh</code> sẽ tự tải về nhé, link ở đây <a href="https://github.com/hanwckf/padavan-toolchain/releases/download/v1.1/mipsel-linux-uclibc.tar.xz">mipsel-linux-uclibc.tar.xz</a>. Còn tui lỡ build rồi thì build hết luôn, ngại ngần chi nữa.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">&gt; cd /build/rt-n56u/toolchain-mipsel
&gt; ulimit -n <span style="color:#ae81ff">4096</span>
&gt; ./clean_toolchain
&gt; ./build_toolchain

...
<span style="color:#f92672">[</span>INFO <span style="color:#f92672">]</span>  Finishing installation <span style="color:#f92672">(</span>may take a few seconds<span style="color:#f92672">)</span>...
<span style="color:#f92672">[</span>37:34<span style="color:#f92672">]</span> / <span style="color:#f92672">====================</span>All IS DONE!<span style="color:#f92672">========================</span>
</code></pre></div><h2 id="3-build-firmware">3. Build firmware</h2>
<p>Tool tiếc xong cả rồi, bây giờ sẽ cần cập nhật template config tương ứng với model router cần build và build firmware:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">&gt; cd /build/rt-n56u/trunk
&gt; grep -v <span style="color:#e6db74">&#39;^#&#39;</span> configs/templates/MI-4.config  | grep -v <span style="color:#e6db74">&#34;^</span>$<span style="color:#e6db74">&#34;</span> | grep -v <span style="color:#e6db74">&#34;=n&#34;</span>
CONFIG_VENDOR<span style="color:#f92672">=</span>Ralink
CONFIG_PRODUCT<span style="color:#f92672">=</span>MT7621
CONFIG_FIRMWARE_PRODUCT_ID<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;MI-4&#34;</span>
CONFIG_LINUXDIR<span style="color:#f92672">=</span>linux-3.4.x
CONFIG_FIRMWARE_WIFI2_DRIVER<span style="color:#f92672">=</span>4.1
CONFIG_FIRMWARE_WIFI5_DRIVER<span style="color:#f92672">=</span>3.0
CONFIG_FIRMWARE_ENABLE_IPV6<span style="color:#f92672">=</span>y
CONFIG_FIRMWARE_INCLUDE_IPSET<span style="color:#f92672">=</span>y
CONFIG_FIRMWARE_INCLUDE_LANG_EN<span style="color:#f92672">=</span>y
CONFIG_FIRMWARE_INCLUDE_TCPDUMP<span style="color:#f92672">=</span>y
CONFIG_FIRMWARE_INCLUDE_EAP_PEAP<span style="color:#f92672">=</span>y
CONFIG_FIRMWARE_INCLUDE_SFTP<span style="color:#f92672">=</span>y
CONFIG_FIRMWARE_INCLUDE_OPENSSH<span style="color:#f92672">=</span>y
CONFIG_FIRMWARE_INCLUDE_OPENSSL_EC<span style="color:#f92672">=</span>y
CONFIG_FIRMWARE_INCLUDE_OPENSSL_EXE<span style="color:#f92672">=</span>y
CONFIG_FIRMWARE_INCLUDE_CURL<span style="color:#f92672">=</span>y
CONFIG_FIRMWARE_INCLUDE_MINIEAP<span style="color:#f92672">=</span>y
CONFIG_FIRMWARE_INCLUDE_HTOP<span style="color:#f92672">=</span>y
CONFIG_FIRMWARE_INCLUDE_NANO<span style="color:#f92672">=</span>y
CONFIG_FIRMWARE_INCLUDE_IPERF3<span style="color:#f92672">=</span>y
CONFIG_FIRMWARE_INCLUDE_MTR<span style="color:#f92672">=</span>y
CONFIG_FIRMWARE_INCLUDE_SOCAT<span style="color:#f92672">=</span>y
CONFIG_FIRMWARE_INCLUDE_SRELAY<span style="color:#f92672">=</span>y
CONFIG_FIRMWARE_INCLUDE_WIREGUARD<span style="color:#f92672">=</span>y
</code></pre></div><p>Bỏ hết các tính năng không cần thiết hoặc chưa có như cầu sử dụng như:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff"> ### using samba3.6 instead of samba3
<span style="color:#f92672">-CONFIG_FIRMWARE_INCLUDE_SMBD36=y
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+CONFIG_FIRMWARE_INCLUDE_SMBD36=n
</span><span style="color:#a6e22e"></span>
 ### Include WINS server only. ~0.4MB
 CONFIG_FIRMWARE_INCLUDE_WINS=n
<span style="color:#75715e">@@ -174,7 +175,7 @@ CONFIG_FIRMWARE_INCLUDE_DROPBEAR_FAST_CODE=n
</span><span style="color:#75715e"></span> CONFIG_FIRMWARE_INCLUDE_OPENSSH=y

 ### Include OpenVPN. IPv6 required. openssl ~1.2MB, openvpn ~0.4MB
<span style="color:#f92672">-CONFIG_FIRMWARE_INCLUDE_OPENVPN=y
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+CONFIG_FIRMWARE_INCLUDE_OPENVPN=n
</span><span style="color:#a6e22e"></span>
 ### Include StrongSwan. XFRM modules ~0.2MB, strongswan ~0.7MB
 CONFIG_FIRMWARE_INCLUDE_SSWAN=n
<span style="color:#75715e">@@ -186,7 +187,7 @@ CONFIG_FIRMWARE_INCLUDE_OPENSSL_EC=y
</span><span style="color:#75715e"></span> CONFIG_FIRMWARE_INCLUDE_OPENSSL_EXE=y

 ### Include xUPNPd IPTV mediaserver. ~0.3MB
<span style="color:#f92672">-CONFIG_FIRMWARE_INCLUDE_XUPNPD=y
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+CONFIG_FIRMWARE_INCLUDE_XUPNPD=n
</span><span style="color:#a6e22e"></span>
 ### Include Minidlna UPnP mediaserver. ~1.6MB
 CONFIG_FIRMWARE_INCLUDE_MINIDLNA=n
<span style="color:#75715e">@@ -195,7 +196,7 @@ CONFIG_FIRMWARE_INCLUDE_MINIDLNA=n
</span><span style="color:#75715e"></span> CONFIG_FIRMWARE_INCLUDE_FIREFLY=n

 ### Include ffmpeg 0.11.x instead of 0.6.x for Minidlna and Firefly. ~0.1MB
<span style="color:#f92672">-CONFIG_FIRMWARE_INCLUDE_FFMPEG_NEW=y
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+CONFIG_FIRMWARE_INCLUDE_FFMPEG_NEW=n
</span><span style="color:#a6e22e"></span>
 ### Include Transmission torrent. openssl ~1.2MB, transmission ~1.5MB
 CONFIG_FIRMWARE_INCLUDE_TRANSMISSION=n
<span style="color:#75715e">@@ -215,13 +216,13 @@ CONFIG_FIRMWARE_INCLUDE_SCUTCLIENT=n
</span><span style="color:#75715e"></span>
 CONFIG_FIRMWARE_INCLUDE_GDUT_DRCOM=n

<span style="color:#f92672">-CONFIG_FIRMWARE_INCLUDE_DOGCOM=y
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+CONFIG_FIRMWARE_INCLUDE_DOGCOM=n
</span><span style="color:#a6e22e"></span>
 CONFIG_FIRMWARE_INCLUDE_MINIEAP=y

<span style="color:#f92672">-CONFIG_FIRMWARE_INCLUDE_NJIT_CLIENT=y
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+CONFIG_FIRMWARE_INCLUDE_NJIT_CLIENT=n
</span><span style="color:#a6e22e"></span>
<span style="color:#f92672">-CONFIG_FIRMWARE_INCLUDE_NAPT66=y
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+CONFIG_FIRMWARE_INCLUDE_NAPT66=n
</span><span style="color:#a6e22e"></span>
<span style="color:#f92672">-CONFIG_FIRMWARE_INCLUDE_VLMCSD=y
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+CONFIG_FIRMWARE_INCLUDE_VLMCSD=n
</span><span style="color:#a6e22e"></span>
<span style="color:#f92672">-CONFIG_FIRMWARE_INCLUDE_TTYD=y
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+CONFIG_FIRMWARE_INCLUDE_TTYD=n
</span><span style="color:#a6e22e"></span>
<span style="color:#f92672">-CONFIG_FIRMWARE_INCLUDE_LRZSZ=y
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+CONFIG_FIRMWARE_INCLUDE_LRZSZ=n
</span><span style="color:#a6e22e"></span>
 CONFIG_FIRMWARE_INCLUDE_HTOP=y

<span style="color:#75715e">@@ -259,4 +260,4 @@ CONFIG_FIRMWARE_INCLUDE_FRPS=n
</span><span style="color:#75715e"></span>
 CONFIG_FIRMWARE_INCLUDE_TUNSAFE=n

<span style="color:#f92672">-CONFIG_FIRMWARE_INCLUDE_WIREGUARD=n
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+CONFIG_FIRMWARE_INCLUDE_WIREGUARD=y
</span></code></pre></div><ul>
<li>OpenVPN thì thường nếu xài VPN service như đám NordVPN nó sẽ cấp ovpn config, lúc đó sẽ tận dụng được một tài khoản NordVPN dùng cho cả nhà. Nhưng OpenVPN thì hơi chậm, mà tui cũng ko xài nên tui bỏ.</li>
<li>Wireguard thì nhanh hơn OpenVPN, nhưng hình như đám VPN service chưa hỗ trợ, còn muốn xài thì phải tự build 1 cái VPS chạy wireguard để tự dùng nhé.</li>
</ul>
<p>Fen nào thích sửa cái dòng COPYRIGHT thì sửa trong file này <a href="https://github.com/hanwckf/rt-n56u/blob/c9c3cec65c619dd8a1f51eee1d305d09d474fff6/trunk/user/www/Makefile#L12">Makefile</a>, sau khi biên dịch, load UI thì ở dưới footer sẽ thấy dòng chữ kiểu kiểu vầy nhé:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">© 2011-2021 Padavan <span style="color:#960050;background-color:#1e0010">&amp;</span> N56U project community 
			Compiled by xluffy
</code></pre></div><p>Sau đó bắt đầu biên dịch firmware, nhớ <code>$1</code> là tên của model, dùng để render config build từ cái file config template phía trên nhé, nó sẽ chép template phía trên ra <code>.config</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">&gt; cd /build/rt-n56u/trunk <span style="color:#f92672">&amp;&amp;</span> fakeroot ./build_firmware_modify MI-4
</code></pre></div><p>Sau khi biên dịch xong, custom firmware sẽ được đặt tại thư mục <code>rt-n56u/trunk/images</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">&gt; ls -larht rt-n56u/trunk/images

total 27M
drwxr-xr-x <span style="color:#ae81ff">14</span> root root 4.0K Nov <span style="color:#ae81ff">11</span> 08:38 ..
-rw-r--r--  <span style="color:#ae81ff">1</span> root root 7.0M Nov <span style="color:#ae81ff">11</span> 08:50 ramdisk
-rwxr-xr-x  <span style="color:#ae81ff">1</span> root root 3.6M Nov <span style="color:#ae81ff">11</span> 08:50 zImage
-rw-r--r--  <span style="color:#ae81ff">1</span> root root 8.2M Nov <span style="color:#ae81ff">11</span> 08:50 zImage.lzma
drwxr-xr-x  <span style="color:#ae81ff">2</span> root root 4.0K Nov <span style="color:#ae81ff">11</span> 08:50 .
-rw-r--r--  <span style="color:#ae81ff">1</span> root root 8.2M Nov <span style="color:#ae81ff">11</span> 08:50 MI-4_3.4.3.9-099.trx

&gt; sha256 rt-n56u/trunk/images/MI-4_3.4.3.9-099.trx
7988f80e1ddddc348469c61971e45a224f921e69347d9cf400160795fcc450ef  MI-4_3.4.3.9-099.trx
</code></pre></div><p>Ở đây ta sẽ chỉ cần file <code>MI-4_3.4.3.9-099.trx</code>, nạp file này vào device và xài.</p>
<p>Sau khi nạp firmware mới, chờ thiết bị khởi động xong, sẽ thấy có 2 AP mới là <code>&lt;Model&gt;_xxx</code> và <code>Model_5G_xxx</code>, ví dụ của tui sẽ là <code>MI-4_4557</code> và <code>MI-4_5G_4557</code>, kết nối vào AP này với mật khẩu mặc định là <code>1234567890</code>. Sau đó truy cập vào web console với thông tin đăng nhập mặc định là <code>admin/admin</code> (hoặc các thông tin tuỳ chỉnh trong tệp <a href="https://github.com/andy-padavan/rt-n56u/blob/master/trunk/user/shared/defaults.h"><code>rt-n56u/trunk/user/shared/defaults.h</code></a>).</p>
<p>Địa chỉ truy cập Web console thông thường sẽ là <code>192.169.31.1</code>, tuy nhiên có thể sẽ khác nên chỉ cần nhìn vào IP được cấp phát bởi DHCP sau khi kết nối AP để đoán dải mạng và truy cập địa chỉ đầu tiên <code>.1</code> vào.</p>
<p>Có một vấn đề nhỏ liên quan đến <a href="https://apple.stackexchange.com/questions/427432/very-slow-to-establish-a-tcp-connection-with-the-router">macOS &gt; 11.4</a> (tui cũng bị với macOS 12.0.1, Monterey) đó là truy cập web console rất chậm, phản hồi mất vài chục giây (nhưng <code>ping</code> thì phản hồi vẫn rất nhanh ~ vài ms, tuy nhiên nếu thử ở các phiên bản macOS thấp hơn hoặc Windows thì vẫn nhanh như thường, nên có vẻ ko phải vấn đề do firmware và router (lúc đầu tưởng firmware có bug làm highload system). Vẫn chưa biết cách fix, nhưng tạm thời có thể dùng máy khác cấu hình nên cũng chưa ảnh hưởng lắm.</p>
<h2 id="4-cấu-hình-nâng-cao">4. Cấu hình nâng cao</h2>
<p>Tệp <a href="https://github.com/andy-padavan/rt-n56u/blob/master/trunk/user/shared/defaults.h"><code>rt-n56u/trunk/user/shared/defaults.h</code></a> có một số tuỳ chỉnh, giúp tui build một bản build hoàn chỉnh để hạn chế các bước cấu hình khi trên web console sau khi nạp firmware:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#define SYS_USER_ROOT		&#34;r00t&#34;</span>
<span style="color:#75715e">#define DEF_ROOT_PASSWORD	&#34;r000t@dBl2021&#34;</span>
</code></pre></div><p>=&gt; Dùng để đổi user/password đăng nhập console</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#define DEF_LAN_ADDR		&#34;10.69.96.1&#34;</span>
<span style="color:#75715e">#define DEF_LAN_DHCP_BEG	&#34;10.69.96.100&#34;</span>
<span style="color:#75715e">#define DEF_LAN_DHCP_END	&#34;10.69.96.244&#34;</span>
<span style="color:#75715e">#define DEF_LAN_MASK		&#34;255.255.255.0&#34;</span>
</code></pre></div><p>=&gt; Lớp mạng sau khi kết nối AP, ví dụ <code>DEF_LAN_ADDR</code> là địa chỉ dùng để truy cập vào web console</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#define DEF_WLAN_2G_SSID	&#34;ASUS&#34;</span>
<span style="color:#75715e">#define DEF_WLAN_5G_SSID	&#34;ASUS_5G&#34;</span>
<span style="color:#75715e">#define DEF_WLAN_2G_GSSID	&#34;ASUS_GUEST&#34;</span>
<span style="color:#75715e">#define DEF_WLAN_5G_GSSID	&#34;ASUS_GUEST_5G&#34;</span>
</code></pre></div><p>=&gt; Tên của AP sau khi nạp kernel, có thể dùng BOARD_PID để gen AP name dựa trên BOARD</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#define DEF_WLAN_2G_SSID        BOARD_PID &#34;_xluffy_%s&#34;</span>
<span style="color:#75715e">#define DEF_WLAN_5G_SSID        BOARD_PID &#34;_5G_xluffy_%s&#34;</span>
<span style="color:#75715e">#define DEF_WLAN_2G_GSSID       BOARD_PID &#34;_GUEST_%s&#34;</span>
<span style="color:#75715e">#define DEF_WLAN_5G_GSSID       BOARD_PID &#34;_GUEST_5G_%s&#34;</span>
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#define DEF_WLAN_2G_PSK		&#34;r000t@dBl2021&#34;</span>
<span style="color:#75715e">#define DEF_WLAN_5G_PSK		&#34;r000t@dBl2021&#34;</span>
</code></pre></div><p>=&gt; Mật khẩu đăng nhập mặc định của AP</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#define DEF_TIMEZONE		&#34;UTC-7&#34;</span>
<span style="color:#75715e">#define DEF_NTP_SERVER0		&#34;vn.pool.ntp.org&#34;</span>
<span style="color:#75715e">#define DEF_NTP_SERVER1		&#34;2.vn.pool.ntp.org&#34;</span>
</code></pre></div><p>=&gt; Múi giờ mặc định (lưu ý là <code>GTM+7</code> sẽ là <code>UTC-7</code>), NTP server mặc định</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#define DEF_WLAN_2G_CC          &#34;US&#34;</span>
<span style="color:#75715e">#define DEF_WLAN_5G_CC          &#34;US&#34;</span>
</code></pre></div><p>=&gt; <code>rt_country_code</code> hay <code>region_code</code>, trong tab cấu hình của AP, dưới cùng sẽ cho phép thay đổi channels AP dựa trên region code.</p>
<h2 id="5-chặn-quảng-cáo">5. Chặn quảng cáo</h2>
<p>Cơ chế chặn quảng cáo cũng đơn giản như setup trên máy tính cá nhân, cơ chế là phân giải các domain quảng cáo về một địa chỉ IP không truy cập được (127.0.0.1 hoặc 0.0.0.0). Ở đây hầu hết là dùng <code>dnsmasq</code> để làm DNS server, (tuỳ chọn cung cấp dịch vụ DHCP luôn)  hỗ trợ nạp tệp <code>hosts</code> chứa các domain quảng cáo.</p>
<p>Về cơ bản hiểu cách <code>dnsmasq</code> hoạt động sẽ hiểu cách cấu hình để chặn quảng cáo cho firmware này. Cấu hình dịch vụ DNS đơn giản chỉ vầy:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ini" data-lang="ini"><span style="color:#75715e"># DNS configuration</span>
<span style="color:#a6e22e">port</span><span style="color:#f92672">=</span><span style="color:#e6db74">53</span>
<span style="color:#a6e22e">listen-address</span><span style="color:#f92672">=</span><span style="color:#e6db74">127.0.0.1,10.69.96.1</span>
 
<span style="color:#a6e22e">domain-needed</span>
<span style="color:#a6e22e">bogus-priv</span>
<span style="color:#a6e22e">strict-order</span>
 
<span style="color:#a6e22e">no-hosts</span>
<span style="color:#a6e22e">domain</span><span style="color:#f92672">=</span><span style="color:#e6db74">taoquangne.local</span>
<span style="color:#a6e22e">cache-size</span><span style="color:#f92672">=</span><span style="color:#e6db74">1000</span>

<span style="color:#a6e22e">addn-hosts</span><span style="color:#f92672">=</span><span style="color:#e6db74">/tmp/hosts.blocked</span>
<span style="color:#a6e22e">addn-hosts</span><span style="color:#f92672">=</span><span style="color:#e6db74">/tmp/hosts.allow</span>
</code></pre></div><p>Phần cấu hình DHCP như vầy</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ini" data-lang="ini"><span style="color:#75715e"># DHCP configuration</span>
<span style="color:#a6e22e">dhcp-range</span><span style="color:#f92672">=</span><span style="color:#e6db74">10.69.96.100,10.69.96.244.240,255.255.255.0,24h</span>
<span style="color:#a6e22e">dhcp-option</span><span style="color:#f92672">=</span><span style="color:#e6db74">option:router,10.69.96.1</span>
<span style="color:#a6e22e">dhcp-option</span><span style="color:#f92672">=</span><span style="color:#e6db74">option:dns-server,10.69.96.1</span>
<span style="color:#a6e22e">dhcp-option</span><span style="color:#f92672">=</span><span style="color:#e6db74">option:netmask,255.255.255.0</span>
</code></pre></div><p>Nhưng dự là đã được xử lý ở <a href="https://github.com/andy-padavan/rt-n56u/blob/master/trunk/user/shared/defaults.h"><code>rt-n56u/trunk/user/shared/defaults.h</code></a> rồi, bước này xem thêm cho biết thôi nhé</p>
<p>Nếu ngại tiếng Trung, mấy fen có thể kiếm mấy dự án tiếng Anh và có hỗ trợ router MI-R3G. Giữa MI-4 và MI-R3G chỉ khác nhau <a href="https://github.com/hanwckf/rt-n56u/issues/669">một chút</a> (credit <a href="https://github.com/minax007">minax007</a>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">RAM size: <span style="color:#ae81ff">128</span> MB instead of <span style="color:#ae81ff">256</span> MB
GPIO: Mi-Net button
LAN1/LAN2/WAN port assignments
No USB port
</code></pre></div><p>Chi tiết ở <a href="https://github.com/hanwckf/rt-n56u/pull/671">PR #671</a></p>
<h2 id="6-bootloader-và-breed-bootloader">6. Bootloader và BREED bootloader</h2>
<p>Fen nào quen thuộc với hệ điều thành Linux sẽ quen thuộc với 2 bootloader như GRUB hoặc Syslinux. Hiểu một cách đơn giản thì bootloader chịu trách nhiệm nạp kernel và khởi tạo ramdisk trước khi bắt đầu quá trình khởi động. Đây là diễn giải về quá <a href="https://wiki.archlinux.org/title/Arch_boot_process">boot process trong ArcLinux</a> tương tự vậy cho các thiết bị nhúng như router, bootloader cũng có <a href="https://openwrt.org/docs/techref/bootloader">chức năng khởi tạo phần cứng và nạp kernel</a>.</p>
<p>Theo tui được biết thì các thiết bị nhúng hay xài nhất là U-Boot bootloader, cá nhân tui cũng đánh giá cao dự án này vì:</p>
<ul>
<li>Dự án nguồn mở phát hành dưới giấy phép GPLv2.</li>
<li>Dự án vẫn được phát triển và bảo trì liên tục, tại thời điểm viết bài này tui thấy last commit là 15 hours ago. Source code đặt tại <a href="https://source.denx.de/u-boot/u-boot">https://source.denx.de/u-boot/u-boot.</a></li>
<li>Website đầy đủ thông tin và chuyên nghiệp vl, cảm giác khá tin tưởng <a href="http://www.denx.de/wiki/U-Boot/WebHome">http://www.denx.de/wiki/U-Boot/WebHome.</a></li>
</ul>
<p>Tuy nhiên cộng đồng thì lại khoái xài BREED bootloader (Boot and Recovery Environment for Embedded Devices - BREED), bootloader này được thím <a href="https://github.com/hackpascal">hackpascal</a> một lập trình viên Trung Quốc phát triển với một số đặc điểm sau:</p>
<ul>
<li>Không dính dáng gì tới U-Boot, là một phiên bản độc lập, phát triển từ đầu.</li>
<li>Miễn phí nhưng <strong>không phải mã nguồn mở</strong>, nên ông nào xài thì tự chịu trách nhiệm với bản thân nhé.</li>
<li>Hỗ trợ upgrade realtime firmware qua giao diện web (tức là mấy ông zô WEB, bấm upload firmware hoặc paste link vô nó tự mần, khác với các bản bootloader khác là phải <code>scp</code> lên, chạy lệnh nạp bootloader vào phân vùng này, phân vùng kia  &hellip;)</li>
</ul>
<p>Thông tin về bootloader này khá hạn chế, tác giả chỉ cung cấp link tải tại <a href="https://breed.hackpascal.net/">https://breed.hackpascal.net/</a> và giới thiệu về BREED ở <a href="https://www.right.com.cn/forum/thread-161906-1-1.html">https://www.right.com.cn/forum/thread-161906-1-1.html</a>, khổ cái toàn tiếng Trung, dịch mãi cũng không rõ là viết cái gì =)). Tuy nhiên tác giả vẫn cập nhật bootloader này, lần cập nhật cuối cùng là vào ngày 09-10-2020.</p>
<p><em><strong>Xin lưu ý lại một lần nữa là BREED không phải phần mềm mã nguồn mở, nên tui không biết tác giả làm gì trong mã nguồn, nếu đã chấp nhận xài là chấp nhận rủi ro.</strong></em></p>
<p>Và như đã nói ở đầu thì tui đoán cái thím bán cho tui con MI-4 này cũng xài BREED vì nó tiện cho quá trình nạp Padavan, thành ra cũng hơi nghi ngại. Dự án U-Boot thì xịn xò thế kia, tội gì ko thử?</p>
<p>Cách cài BREED thì rất nhiều các bản <a href="https://4pda.to/forum/index.php?showtopic=975687&amp;st=8240#entry104304281">tiếng Nga</a>, tiếng Việt trên <a href="https://voz.vn/t/dap-hop-xiaomi-redmi-router-ac2100.48554/#post-1322727">VoZ</a>, diễn đàn <a href="https://miui.vn/forum/threads/padavan-custom-firmware-qos-iptv-transmission-for-xioami-router-gen3-gen3g-mini-nano.24161/">miui.vn</a> đủ cả, tự tìm nhé.</p>
<h2 id="7-restore-bootloader-stock-và-rom-stock">7. Restore bootloader stock và ROM stock</h2>
<p>Các bước như sau:</p>
<ul>
<li>Quay về bootloader stock thay vì BREED bootloader</li>
<li>Quay về ROM stock</li>
</ul>
<p>Phần mềm cần chuẩn bị:</p>
<ul>
<li>Bootloader stock, riêng cái này không tìm đâu ra bản official được, tui chỉ tìm được một bản của thím <a href="https://voz.vn/u/lethanhtuan2895.1052437/">lethanhtuan2895</a> ở <a href="https://www.dropbox.com/sh/triqs68g4zapi7m/AAAPQJYS7FxglkbsOJpUQH6Fa?dl=0">Bootloader_MIR4.zip</a>, trên <a href="https://4pda.to/forum/index.php?showtopic=905966&amp;st=6740#entry105136079">4pda.to</a> có nhưng link hiện tại đã die hoặc do tui không có tài khoản đăng nhập.</li>
<li><a href="https://bigota.miwifi.com/xiaoqiang/tools/MIWIFIRepairTool.x86.zip">MIWifiRepairToolX86</a> nếu link die thì mấy ông vô <a href="http://miwifi.com/miwifi_download.html">MiWifil</a> kiếm hàng nhé, chỗ nào có cái biểu tượng Windows PC thì dò dò vào xem link.</li>
<li>Firmware gốc <a href="https://bigota.miwifi.com/xiaoqiang/rom/r4/miwifi_r4_firmware_8ed47_2.26.175.bin">miwifi_r4_firmware_8ed47_2.26.175</a></li>
</ul>
<p>Cách bước làm thì thím <a href="https://voz.vn/t/chia-se-rom-padavan-tieng-viet-cho-xiaomi-router-r3g-v1-co-usb.108869/">lethanhtuan2895</a> có hướng dẫn rồi nhé.</p>
<p>May mắn thay, sau một hồi lần mò trên <a href="https://forum.openwrt.org/t/xiaomi-mi-wifi-r4-exploration/23322">OpenWrt</a> tui đã nhìn thấy bản backup uboot mà thím thread này đã cẩn thận backup lại tại <a href="https://drive.google.com/open?id=1EpBAV_vEpvtyL0vZ-j82saMSX6JvJN5o">link này</a>, xin phép tải về lưu trữ chứ tìm cực quá:</p>
<p>Sau đó tui kiểm tra checksum với bản của thím <a href="https://voz.vn/u/lethanhtuan2895.1052437/">lethanhtuan2895</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># bản của 0shape trên OpenWrt</span>
&gt; sha256sum Bootloader.bin
89b517f76073e9e093f05d9baf6df003a3d1fa82d46e6421914ef0650ee4583d  Bootloader.bin

<span style="color:#75715e"># bản của lethanhtuan2895</span>
&gt; sha256sum Bootloader/Bootloader_MIR4.bin
89b517f76073e9e093f05d9baf6df003a3d1fa82d46e6421914ef0650ee4583d  Bootloader/Bootloader_MIR4.bin
</code></pre></div><p>Ngon, đỡ phải tự build, hi vọng 2 thím này không phải là 1🤏, ko là xu cà na luôn.</p>
<h2 id="8-kết-quả">8. Kết quả</h2>
<p>Việc còn lại là:</p>
<ul>
<li>Load lại bootloader</li>
<li>Load lại stock firmware</li>
<li>Cài Padavan bản build ở mục 3</li>
</ul>
<h2 id="9-tự-build-u-boot-bonus">9. Tự build U-Boot (bonus)</h2>
<p>Ông nào muốn tự build U-Boot thì có thể nghía 2 repo sau:</p>
<ul>
<li><a href="https://github.com/pepe2k/u-boot_mod">pepe2k/u-boot_mod</a></li>
<li><a href="https://github.com/shibajee/u-boot_mod">shibajee/u-boot_mod</a></li>
</ul>
<p>Với bản mod của thím <strong>pepe2k</strong>:</p>
<ul>
<li>based trên U-Boot 1.14, sửa tùm lum tà la nhưng dựa trên <strong>TP-Link</strong> là chủ yếu, ngoài có thêm mã của đám <strong>Link</strong>, <strong>Netgear</strong>, <strong>ZyXEL</strong> và <strong>Belkin</strong>, tất cả các cty này sử dụng SDK từ Qualcomm/Atheros.</li>
<li>Mục tiêu của bản mod này là hỗ trợ các thiết bị router yếu yếu của TP-Link, ví dụ con <strong>TL-WR703N</strong>, nhưng bây giờ thì hỗ trợ tùm lum tè le các thiết bị <a href="https://github.com/pepe2k/u-boot_mod#supported-devices"><strong>Atheros AR934x</strong>, <strong>Qualcomm Atheros QCA953x</strong>, <strong>Qualcomm Atheros QCA955x</strong></a>.</li>
<li>Cơ mà đen cái là chưa hỗ trợ <strong>Qualcomm Atheros QCA956x</strong> và <strong>MediaTek MT762x</strong>, trong đó chip MT762x là cái con tui đang xài, xu cà na luôn 🥺🥺🥺.</li>
<li>Tuy nhiên tui nghía thử thì bản mod này khá xịn, hỗ trợ upgrade firmware, U-Boot và ART (Atheros Radio Test) image trực tiếp thông qua giao diện web luôn, khỏi cần qua mấy cổng serial và TFTP. <a href="https://github.com/pepe2k/u-boot_mod#web-server">[1]</a></li>
<li>Có hướng dẫn build cụ thể trên Linux và macOSX <a href="https://github.com/pepe2k/u-boot_mod#web-server">[2]</a></li>
</ul>
<p>Còn bản mod của thím <strong>shibajee</strong> có hỗ trợ Mediatek SoC, chip MT7621 và tui có thấy config cho con MI-R3G_SPI, con này có vẻ hơi giống con MI-R4 của tui. Tụi Mì xào này đặt tên lằng nhằng vãi, anh em check specs kĩ nhé, search xui xui toàn ra mấy con MI Phone, cay:</p>
<ul>
<li><a href="https://openwrt.org/toh/xiaomi/mir3g">https://openwrt.org/toh/xiaomi/mir3g</a>, lưu ý là ko phải bản MI-R3 (ko có G nhé) bản R3G nó cũng có 2 version là V1 và V2.</li>
<li><a href="https://www.mi.com/miwifi3g/specs/">So sánh con R3G và R3 không G</a>.</li>
</ul>
<h2 id="10-túm-lại">10. Túm lại</h2>
<p>Với giá <strong>350k</strong>, được một con AP có cấu hình khá xịn xò, quay cả được PPPoE (n<del>hưng nghe bảo gói home của nhà mạng ko cho cấu hình thiết bị đính kèm thành bridge nên tui cũng chưa thử</del>), chạy 2 băng tần, firmware mở với nhiều tính năng tốt, nói chung là cũng khá hời.</p>
<p>Khúc bảo các gói home của nhà mạng ko cho cấu hình thiết bị đính kèm thành bridge có vẻ tui sai, nhà tui xài gói rẻ nhất của VNPT giá 165k, kèm iGate GW020, và tui ngứa tay thử search thì hoá ra vẫn chuyển sang mode bridge được. Nhưng tui chưa thử, cuối tuần này tui sẽ thử. Thế đã nhé.</p>
<p align="center"><img <img src="https://github.com/xluffy/assets/blob/master/meme-daunam.png?raw=true" alt="cáo-từ" style="width:40%;" /></p>

    </div>
    
      
        <div class="pagination">
          <div class="pagination__title">
            <span class="pagination__title-h"
              >Read other posts</span
            >
            <hr />
          </div>
          <div class="pagination__buttons">
            
              <span class="button previous">
                <a href="https://taoquangne.com/post/houseplants-care-101/">
                  <span class="button__icon">←</span>
                  <span class="button__text">Houseplants Care 101</span>
                </a>
              </span>
            
            
              <span class="button next">
                <a href="https://taoquangne.com/post/how-to-check-a-ip-is-in-a-blacklist/">
                  <span class="button__text">How to check a IP is in a blacklist</span>
                  <span class="button__icon">→</span>
                </a>
              </span>
            
          </div>
        </div>
      
    

    
      
        

      
    
  </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright copyright--user"><span> hàng nhà trồng 🌴 theo <a href="https://creativecommons.org/licenses/by-nc/4.0">giấy phép CC BY-NC 4.0</a></span><span>Themes created by <a href="https://twitter.com/panr" target="_blank" rel="noopener">panr</a></span></div>
      
  </div>
</footer>

<script src="https://taoquangne.com/assets/main.js"></script>
<script src="https://taoquangne.com/assets/prism.js"></script>


      
    </div>

    
  </body>
</html>
